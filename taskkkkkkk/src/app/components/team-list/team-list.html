<div class="teams-container">
  @if (errorMessage()) {
  <div class="error-banner">
    <p>❌ {{ errorMessage() }}</p>
    <button (click)="errorMessage.set(null)">✖</button>
  </div>
  }

  <div class="teams-header">
    <div class="header-content">
      <h1>
        <mat-icon class="header-icon">groups</mat-icon>
        הצוותים שלי
      </h1>
      <p class="header-subtitle">נהלי ותשתפי פעולה עם הצוות שלך</p>
    </div>

    <button 
      mat-fab 
      color="accent"
      (click)="toggleCreate()"
      class="fab-button"
      [matTooltip]="isCreateOpen() ? 'סגור' : 'צור צוות חדש'">
      <mat-icon>{{ isCreateOpen() ? 'close' : 'add' }}</mat-icon>
    </button>
  </div>

  @if (isCreateOpen()) {
    <div class="create-team-box">
      <mat-card class="create-card">
        <mat-card-header>
          <mat-card-title>צור צוות חדש</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>שם הצוות</mat-label>
            <input 
              matInput 
              [formControl]="newTeamNameControl"
              placeholder="לדוגמה: צוות הדיזיין">
            @if (newTeamNameControl.hasError('required')) {
              <mat-error>שם צוות נדרש</mat-error>
            }
            @if (newTeamNameControl.hasError('minlength')) {
              <mat-error>שם חייב להיות לפחות 2 תווים</mat-error>
            }
          </mat-form-field>
        </mat-card-content>

        <mat-card-actions>
          <button 
            mat-button 
            (click)="toggleCreate()">ביטול</button>
          <button 
            mat-raised-button 
            color="primary"
            (click)="createNewTeam()"
            [disabled]="newTeamNameControl.invalid">
            <mat-icon>add</mat-icon>
            צור צוות
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  }

  <div class="teams-content">
    @if (teamsService.isLoading()) {
      <div class="status-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>טוען צוותים...</p>
      </div>
    } @else if (teamsService.error()) {
      <mat-card class="error-card">
        <mat-card-content class="error-content">
          <mat-icon>error_outline</mat-icon>
          <p>{{ teamsService.error() }}</p>
        </mat-card-content>
      </mat-card>
    } @else if ((teamsService.myTeams() || []).length === 0) {
      <div class="empty-state">
        <mat-icon class="empty-icon">groups</mat-icon>
        <h2>אין צוותים עדיין</h2>
        <p>יצרי את הצוות הראשון שלך וקדמי קדימה!</p>
        <button mat-raised-button color="primary" (click)="toggleCreate()">
          <mat-icon>add</mat-icon>
          צור צוות חדש
        </button>
      </div>
    } @else {
      <div class="teams-grid">
        @for (team of teamsService.myTeams(); track team.id) {
          <mat-card class="team-card">
            <mat-card-header>
              <div class="card-header-content">
                <mat-icon class="team-icon">groups</mat-icon>
                <div>
                  <mat-card-title>{{ team.name }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-icon class="member-icon">person</mat-icon>
                    {{ team.members_count || 0 }} חברים
                  </mat-card-subtitle>
                </div>
              </div>
            </mat-card-header>

            <mat-card-content>
              <p class="team-description">צוות פעיל עם משימות</p>
            </mat-card-content>

            <mat-card-actions>
              <button 
                mat-button 
                color="primary"
                [routerLink]="['/projects', team.id]">
                <mat-icon>folder_open</mat-icon>
                צפה בפרויקטים
              </button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  </div>
</div>