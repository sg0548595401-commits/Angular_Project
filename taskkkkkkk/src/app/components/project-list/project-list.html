<div class="projects-container">
  <div class="projects-header">
    <div class="header-content">
      <h1>
        <mat-icon class="header-icon">folder_special</mat-icon>
        פרויקטים של הצוות
      </h1>
      <p class="header-subtitle">ניהול ועקוב אחר הפרויקטים שלך</p>
    </div>

    <button 
      mat-fab 
      color="accent"
      (click)="toggleCreate()"
      class="fab-button"
      [matTooltip]="isCreateOpen() ? 'סגור' : 'פרויקט חדש'">
      <mat-icon>{{ isCreateOpen() ? 'close' : 'add' }}</mat-icon>
    </button>
  </div>

  @if (projectsService.isLoading()) {
    <div class="status-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>טוען פרויקטים...</p>
    </div>
  } @else {
    @if (isCreateOpen()) {
      <div class="create-project-box">
        <mat-card class="create-card">
          <mat-card-header>
            <mat-card-title>פרויקט חדש</mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="projectForm" class="form">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>שם הפרויקט</mat-label>
                <input matInput formControlName="name" placeholder="לדוגמה: אפליקציית מוקד">
                @if (projectForm.get('name')?.hasError('required')) {
                  <mat-error>שם נדרש</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>תיאור הפרויקט</mat-label>
                <textarea matInput formControlName="description" placeholder="תיאור אופציונלי..." rows="4"></textarea>
              </mat-form-field>
            </form>
          </mat-card-content>

          <mat-card-actions>
            <button mat-button (click)="toggleCreate()">ביטול</button>
            <button 
              mat-raised-button 
              color="primary"
              (click)="createProject()"
              [disabled]="projectForm.invalid">
              <mat-icon>add</mat-icon>
              צור פרויקט
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    }

    <div class="projects-content">
      @if ((teamProjects() || []).length === 0) {
        <div class="empty-state">
          <mat-icon class="empty-icon">folder_open</mat-icon>
          <h2>אין פרויקטים עדיין</h2>
          <p>אפשר ליצור את הפרויקט הראשון שלך</p>
          <button mat-raised-button color="primary" (click)="toggleCreate()">
            <mat-icon>add</mat-icon>
            צור פרויקט חדש
          </button>
        </div>
      } @else {
        <div class="projects-grid">
          @for (project of teamProjects(); track project.id) {
            <mat-card class="project-card" [routerLink]="['/projects', project.id, 'tasks']">
              <mat-card-header>
                <div class="card-header-content">
                  <mat-icon class="project-icon">folder</mat-icon>
                  <div>
                    <mat-card-title>{{ project.name }}</mat-card-title>
                    <mat-card-subtitle>פרויקט פעיל</mat-card-subtitle>
                  </div>
                </div>
              </mat-card-header>

              <mat-card-content>
                <p class="description">{{ project.description }}</p>
              </mat-card-content>

              <mat-card-actions>
                <button mat-button color="primary">
                  <mat-icon>arrow_forward</mat-icon>
                  צפה במשימות
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      }
    </div>
  }
</div>